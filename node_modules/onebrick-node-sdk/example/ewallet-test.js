const {
    BrickSDK,
    ENVIRONMENT
} = require("../dist");
const readline = require("readline");

const clientId = "2193af78-1bbe-4a00-b03f-694c11c552fc"
const clientSecret = "xJrbT2993YP89wxy8lK4TPdj72RcYT"
const name = "BRICK"
const url = "https://onebrick.io"

let sdk = new BrickSDK(clientId,
    clientSecret,
    ENVIRONMENT.SANDBOX,
    name,
    url);

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});
async function initSDK() {
    let a = await sdk.requestAccessToken();
    let b = await sdk.requestAuthentication();
    console.log(`init SDK Done with params`,b);
}

async function main() {
    await initSDK();
    rl.question("Put Ewallet Institution ID  ", function (institutionId) {
        rl.question("Put Ewallet Phone Number ? ", function (username) {

            sdk.authenticateWithEwallet(username.toString(), parseInt(institutionId.toString())).then((data) => {
                console.log(data);
                if (institutionId == 12) {
                    rl.question("input PIN ", function (otp) {
                        rl.question('input url link', function (url) {
                            sdk.reauthenticateWithOTPEwallletAndLink(parseInt(institutionId.toString()), otp.toString(), url.toString(), ).then((dataOtp) => {
                                console.log(dataOtp)
                                rl.close();
                            }).catch((err) => {
                                console.log(err.response.data);
                                rl.close();
                            });
                        })
                    })
                } else {
                    rl.question("input OTP ", function (otp) {
                        sdk.reauthenticateWithOTPEwalllet(otp.toString(), parseInt(institutionId.toString())).then((dataOtp) => {
                            console.log(dataOtp)
                            rl.close();
                        }).catch((err) => {
                            console.log(err.response.data);
                            rl.close();
                        });
                    })
                }


            }).catch((err) => {
                console.log(err.response.data);
                rl.close();
            });
        })
    });
    rl.on("close", function () {
        console.log("\nBYE BYE !!!");
        process.exit(0);
    });
}
main();