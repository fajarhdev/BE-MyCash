const { BrickSDK, ENVIRONMENT } = require("../dist");
const readline = require("readline");

const clientId = "2193af78-1bbe-4a00-b03f-694c11c552fc";
const clientSecret = "xJrbT2993YP89wxy8lK4TPdj72RcYT";
const name = "BRICK";
const url = "https://onebrick.io";

let sdk = new BrickSDK(clientId, clientSecret, ENVIRONMENT.SANDBOX, name, url);

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
});
async function initSDK() {
  let a = await sdk.requestAccessToken();
  let b = await sdk.requestAuthentication();
  console.log(a);
  console.log(b);
  console.log("init SDK Done");
}

async function main() {
  await initSDK();
  rl.question("Put Bank Institution ID  ", function (institutionId) {
    rl.question("Put Bank username ? ", function (username) {
      rl.question("Put Bank password ? ", function (password) {
        sdk
          .authenticateWithBank(
            username.toString(),
            password.toString(),
            parseInt(institutionId.toString())
          )
          .then((data) => {
            console.log(data);
            rl.close();
          })
          .catch((err) => {
            console.log(err);
            rl.close();
          });
      });
    });
  });
  rl.on("close", function () {
    console.log("\nBYE BYE !!!");
    process.exit(0);
  });
}

main();
